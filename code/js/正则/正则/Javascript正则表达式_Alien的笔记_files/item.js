fml.define("blog:common/global",["blog:common/syntax","blog:common/zoom-detect","blog:common/back2top"],function(a,b){var c=a("blog:common/syntax"),d=a("blog:common/zoom-detect"),e=a("blog:common/back2top");$(function(){$('a[href^="http://mailto:"]').each(function(){$(this).attr("href",$(this).attr("href").replace(/^http\:\/\/mailto\:/,"mailto:"))}),c.highlight(),Session.isMobile||d.start(),e.init();var a=$("#txtAdsCodes"),b=$("#adsScripts");if(a[0]&&b[0])return!1})});fml.define("blog:page/item",["blog:common/core","blog:common/localstorage","blog:common/fullscreen"],function(a,b){var c=a("blog:common/fullscreen"),d=a("blog:common/localstorage"),e=function(){var a=function(){var a=function(a){var b=$("#lblErrorMsg");return b.html(a.msg),b.hide(),a.no&&b.show(300),a.no==0},b=function(b){return b.author_name.value==""?a({no:10,msg:"昵称不能为空"}):b.author_email.value==""?a({no:20,msg:"邮箱不能为空"}):/^[-_A-Za-z0-9\.]+@([_A-Za-z0-9]+.)+[A-Za-z0-9]{2,3}$/.test(b.author_email.value)?b.author_url.value==""?a({no:30,msg:"网址不能为空"}):/^((http|ftp|https):\/\/)?[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/.test(b.author_url.value)?b.content.value==""?a({no:40,msg:"评论内容不能为空"}):b.content.value.length>1e3?a({no:41,msg:"评论内容不能不能超过1000个汉字"}):(a({no:0,msg:"验证通过"}),!0):a({no:31,msg:"网址格式不正确"}):a({no:21,msg:"邮箱件格式不正确"})},e=function(a){$this=$(this),window.confirm("你真的要删除这篇文章吗？")&&$.post(Session.appDomain+"ajax/blog_delete",{id:$this.attr("data-id")},function(a){a=(new Function("return "+a))(),a.errorNo?alert("很抱歉，文章删除失败！"):location.replace(Session.appDomain)}),a.preventDefault()},f=function(a,b,c,d,e,f){$.post(Session.appDomain+"ajax/msg_weixin",{content:e,author_name:d,author_email:c,parent_id:f,blog_title:encodeURIComponent(b),blog_id:a},function(a){})},g=function(a,b,c,d,e){$.post(Session.appDomain+"ajax/msg_email",{author_name:c,content:d,author_email:b,parent_id:e,blog_id:a},function(a){})},h=function(c){var e=$(this),h=$("#cmtForm");if(e.attr("data-locked")=="1")return c.preventDefault(),!1;if(!b(h[0]))return c.preventDefault(),!1;e.attr("data-locked","1").val("发布中..."),$.post(Session.appDomain+"ajax/cmt_create",h.serialize(),function(b){b=(new Function("return "+b))(),a(b.errorInfo);if(!b.errorInfo.no){var c=b.data,i=['<li class="q-cmtitem clearfix">','<div class="c-header">','<a href="',c.author_url,'" target="_blank">',c.author_name,"</a>",'<span class="q-act">','<span class="q-cmtdate">',c.cmt_time,"</span>",'<a href="#" class="a-reply" data-cmtid="',c.id,'" ','data-author="',c.author_name,'">回复</a>',"</span>","</div>",'<pre class="q-content">',$("#content").val(),"</pre>",function(){var a="",b=$("#"+$("#parent_id").val());if(b[0]){a=b.find("pre.q-content").html();var c=b.find(".c-header>a").eq(0).html().trim();a=['<fieldset class="q-parent-content">',"<legend>",c," said:</legend>","<blockquote>",a,"</blockquote>","</fieldset>"].join("")}return a}(),"</li>"].join("");$(i).prependTo(".item-cmtlist .q-cmtlist");var j=$("#spCmtCount");j.html(parseInt(j.html(),10)+1),d.set([{key:"cmtor_name",value:c.author_name},{key:"cmtor_email",value:c.author_email},{key:"cmtor_url",value:c.author_url}]),h[0].reset(),c.author_email=="xianliezhao@foxmail.com"?g(c.blog_id,c.author_email,c.author_name,c.content,c.parent_id):f(c.blog_id,$.trim($("#blogTitle").text()),c.author_email,c.author_name,c.content,c.parent_id)}else a({no:1e3,msg:b.errorMsg});e.attr("data-locked","0").val("发布评论"),$("#parent_id").val(0)}),c.preventDefault()},i=function(){if(window.localStorage){var a=d.get({key:"cmtor_name"});if(!a)return;var b=d.get({key:"cmtor_email"}),c=d.get({key:"cmtor_url"});$("#author_name").val(a),$("#author_email").val(b),$("#author_url").val(c)}},j=function(a){i(),$("#content").focus().val("回复 "+$(this).attr("data-author")+" : "),$("#parent_id").val($(this).attr("data-cmtid")),a.preventDefault()},k=function(a){if($("#author_name").val()||$("#author_email").val()||$("#author_url").val())return;i(),a.preventDefault()},l=null,m=function(a){var b=this;if(!l){var d=$(".mod-postdetail");l=new c({element:d,callback:function(a){a?($(b).html("退出全屏").addClass("fullscreen-yes"),d.removeClass("x-maxwidth")):($(b).html("进入全屏").removeClass("fullscreen-yes"),d.addClass("x-maxwidth"))}})}l.toggleFullscreen(),a.preventDefault()},n={click:{"a-deleteblog":e,"q-btn-reply":h,"a-reply":j,"cmt-iptbox":k,"btn-request-fullscreen":m}},o=function(){window.addEventMap($("body"),["click"],n)};return{run:o}}(),b=function(){a.run()};return{init:b}}();return e});